<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëã±ËØ≠Â≠¶‰π†Â∑•ÂÖ∑ - ÂçáÁ∫ßÁâà</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const API_BASE_URL = 'https://nglish-learning-backend.onrender.com';

        // ÂõæÊ†áÁªÑ‰ª∂
        const Upload = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>;
        const Volume2 = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>;
        const BookOpen = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>;
        const Star = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>;
        const X = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const ArrowLeft = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>;
        const Lightbulb = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 18h6M10 22h4M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"></path></svg>;
        const Save = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path></svg>;
        const Trash2 = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path></svg>;
        const CheckCircle = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>;
        const AlertCircle = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>;

        function EnglishLearningTool() {
            const [image, setImage] = useState(null);
            const [extractedText, setExtractedText] = useState('');
            const [paragraphs, setParagraphs] = useState([]);
            const [translation, setTranslation] = useState('');
            const [words, setWords] = useState([]);
            const [selectedWord, setSelectedWord] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [newWords, setNewWords] = useState(() => {
                try {
                    const saved = localStorage.getItem('englishNewWords');
                    return saved ? JSON.parse(saved) : [];
                } catch { return []; }
            });
            const [masteredWords, setMasteredWords] = useState(() => {
                try {
                    const saved = localStorage.getItem('englishMasteredWords');
                    return saved ? JSON.parse(saved) : [];
                } catch { return []; }
            });
            const [currentView, setCurrentView] = useState('home');
            const [apiStatus, setApiStatus] = useState('checking');
            const audioRef = useRef(null);

            useEffect(() => {
                try {
                    localStorage.setItem('englishNewWords', JSON.stringify(newWords));
                } catch (error) {
                    console.error('‰øùÂ≠òÂ§±Ë¥•');
                }
            }, [newWords]);

            useEffect(() => {
                try {
                    localStorage.setItem('englishMasteredWords', JSON.stringify(masteredWords));
                } catch (error) {
                    console.error('‰øùÂ≠òÂ§±Ë¥•');
                }
            }, [masteredWords]);

            useEffect(() => {
                checkApiStatus();
            }, []);

            const checkApiStatus = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/health`);
                    if (response.ok) {
                        setApiStatus('connected');
                    } else {
                        setApiStatus('error');
                    }
                } catch (error) {
                    setApiStatus('error');
                }
            };

            const handleImageUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = async (event) => {
                    setImage(event.target.result);
                    setIsLoading(true);
                    
                    try {
                        const formData = new FormData();
                        formData.append('image', file);
                        
                        const ocrResponse = await fetch(`${API_BASE_URL}/api/ocr`, {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (!ocrResponse.ok) {
                            throw new Error(`OCR Â§±Ë¥•`);
                        }
                        
                        const ocrData = await ocrResponse.json();
                        let text = ocrData.text;
                        
                        // Á¨¨‰∏ÄÊ≠•:Âü∫Á°ÄÊ∏ÖÁêÜ
                        text = text
                            .replace(/[@#$%^&*()_+=\[\]{}|\\;"'<>,?/~`ÔºÅ@#Ôø•%‚Ä¶‚Ä¶&*ÔºàÔºâ‚Äî‚Äî+=„Äê„Äë„ÄÅ|ÔºõÔºö""''„Ää„ÄãÔºå„ÄÇÔºü]/g, ' ')
                            .replace(/[^\w\s\-.']/g, ' ')
                            .replace(/[ \t]+/g, ' ')
                            .trim();
                        
                        setExtractedText(text);
                        
                        // Á¨¨‰∫åÊ≠•:Êô∫ËÉΩÂàÜÊÆµ
                        let lines = [];
                        
                        if (text.includes('\n')) {
                            // ÊñπÊ°àA: ÊúâÊòéÁ°ÆÊç¢Ë°åÁ¨¶,ÊåâÊç¢Ë°åÊãÜÂàÜ
                            lines = text.split(/\n+/).filter(l => l.trim());
                        } else {
                            // ÊñπÊ°àB: Êó†Êç¢Ë°åÁ¨¶,ÈúÄË¶ÅÊô∫ËÉΩÂà§Êñ≠
                            
                            // Ê£ÄÊü•ÊñáÊú¨ÈïøÂ∫¶ÂíåÁªìÊûÑ
                            const wordCount = text.split(/\s+/).length;
                            
                            if (wordCount <= 30) {
                                // ÊñáÊú¨ËæÉÁü≠(<=30ËØç),‰øùÊåÅÂÆåÊï¥
                                lines = [text];
                            } else {
                                // ÊñáÊú¨ËæÉÈïø,Â∞ùËØïÊåâÂè•Â≠êÊãÜÂàÜ
                                // ‰ΩøÁî®Êõ¥‰∏•Ê†ºÁöÑËßÑÂàô:Âè•Âè∑ÂêéÂøÖÈ°ªË∑üÂ§ßÂÜôÂ≠óÊØçÂºÄÂ§¥ÁöÑÂçïËØç
                                const sentences = text.split(/(?<=[.!?])\s+(?=[A-Z])/);
                                
                                // È™åËØÅÊãÜÂàÜË¥®Èáè:ÊØè‰∏™Âè•Â≠êÂ∫îËØ•ÊúâÂêàÁêÜÁöÑÈïøÂ∫¶(>15‰∏™Â≠óÁ¨¶‰∏î>3‰∏™ÂçïËØç)
                                const validSentences = sentences.filter(s => {
                                    const words = s.trim().split(/\s+/);
                                    return s.trim().length > 15 && words.length > 3;
                                });
                                
                                if (validSentences.length === sentences.length && sentences.length > 1) {
                                    // ÊâÄÊúâÂè•Â≠êÈÉΩÂêàÊ†º,‰ΩøÁî®Âè•Â≠êÊãÜÂàÜ
                                    lines = sentences;
                                } else {
                                    // ÊãÜÂàÜË¥®Èáè‰∏çÂ•Ω,ÊåâÂõ∫ÂÆöÈïøÂ∫¶ÊãÜÂàÜ
                                    const words = text.split(/\s+/);
                                    const chunkSize = 25; // ÊØèÊÆµÁ∫¶25‰∏™ÂçïËØç
                                    for (let i = 0; i < words.length; i += chunkSize) {
                                        const chunk = words.slice(i, i + chunkSize).join(' ');
                                        if (chunk.trim().length > 0) {
                                            lines.push(chunk);
                                        }
                                    }
                                }
                            }
                        }
                        
                        // Á¨¨‰∏âÊ≠•:Ê∏ÖÁêÜÂíåËøáÊª§
                        const cleanedLines = lines
                            .map(line => line.trim())
                            .filter(line => {
                                if (line.length === 0) return false;
                                if (/^\d+$/.test(line)) return false;  // Á∫ØÊï∞Â≠ó
                                if (line.length < 3) return false;  // Â§™Áü≠
                                return true;
                            })
                            .map(line => {
                                // ÂéªÊéâÂçïÁã¨ÁöÑÊï∞Â≠ó
                                return line.replace(/\s+\d+\s+/g, ' ').replace(/^\d+\s+/, '').replace(/\s+\d+$/, '').trim();
                            })
                            .filter(line => line.length >= 3);  // ÂÜçÊ¨°ËøáÊª§Â§™Áü≠ÁöÑ
                        
                        // Á¨¨ÂõõÊ≠•:ÊâπÈáèÁøªËØë(ÂáèÂ∞ëAPIË∞ÉÁî®Ê¨°Êï∞)
                        const parasWithTranslation = [];
                        
                        // Â¶ÇÊûúÊÆµËêΩÂ§™Â§ö(>10‰∏™),ÂêàÂπ∂ÁøªËØë
                        if (cleanedLines.length > 10) {
                            // ÊØè3-5Ë°åÂêàÂπ∂‰∏ÄÊ¨°ÁøªËØë
                            const batchSize = 3;
                            for (let i = 0; i < cleanedLines.length; i += batchSize) {
                                const batch = cleanedLines.slice(i, i + batchSize);
                                const batchText = batch.join('\n');
                                
                                try {
                                    const transResponse = await fetch(`${API_BASE_URL}/api/translate`, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ text: batchText })
                                    });
                                    
                                    if (transResponse.ok) {
                                        const transData = await transResponse.json();
                                        const translations = transData.translation.split('\n');
                                        
                                        batch.forEach((line, idx) => {
                                            parasWithTranslation.push({
                                                text: line,
                                                translation: translations[idx] || transData.translation
                                            });
                                        });
                                    } else {
                                        batch.forEach(line => {
                                            parasWithTranslation.push({
                                                text: line,
                                                translation: 'ÁøªËØëÂ§±Ë¥•,ËØ∑Ê£ÄÊü•ÂêéÁ´ØÈÖçÁΩÆ'
                                            });
                                        });
                                    }
                                } catch (error) {
                                    batch.forEach(line => {
                                        parasWithTranslation.push({
                                            text: line,
                                            translation: 'ÁΩëÁªúÈîôËØØ'
                                        });
                                    });
                                }
                                
                                // ÈÅøÂÖçËØ∑Ê±ÇËøáÂø´
                                await new Promise(resolve => setTimeout(resolve, 500));
                            }
                        } else {
                            // ÊÆµËêΩÂ∞ë,ÂçïÁã¨ÁøªËØë
                            for (const line of cleanedLines) {
                                try {
                                    const transResponse = await fetch(`${API_BASE_URL}/api/translate`, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ text: line })
                                    });
                                    
                                    if (transResponse.ok) {
                                        const transData = await transResponse.json();
                                        parasWithTranslation.push({
                                            text: line,
                                            translation: transData.translation
                                        });
                                    } else {
                                        const errorText = await transResponse.text();
                                        console.error('ÁøªËØëÂ§±Ë¥•:', errorText);
                                        parasWithTranslation.push({
                                            text: line,
                                            translation: 'ÁøªËØëAPIÈîôËØØ,ËØ∑Ê£ÄÊü•ÂêéÁ´ØÊó•Âøó'
                                        });
                                    }
                                } catch (error) {
                                    console.error('ÁøªËØëËØ∑Ê±ÇÂ§±Ë¥•:', error);
                                    parasWithTranslation.push({
                                        text: line,
                                        translation: 'ÁΩëÁªúËøûÊé•Â§±Ë¥•'
                                    });
                                }
                                
                                await new Promise(resolve => setTimeout(resolve, 300));
                            }
                        }
                        
                        setParagraphs(parasWithTranslation);



                        const wordList = text.match(/\b[a-zA-Z]+\b/g) || [];
                        const uniqueWords = [...new Set(wordList.map(w => w.toLowerCase()))];
                        // ËøáÊª§ÊéâÂ∑≤ÊéåÊè°ÁöÑÂçïËØç
                        const masteredSet = new Set(masteredWords.map(w => w.word));
                        const filteredWords = uniqueWords.filter(w => w.length > 2 && !masteredSet.has(w));
                        setWords(filteredWords);

                    } catch (error) {
                        console.error('Â§ÑÁêÜÂ§±Ë¥•:', error);
                        alert('ËØÜÂà´Â§±Ë¥•,ËØ∑ÈáçËØï');
                        setExtractedText('');
                        setTranslation('');
                        setWords([]);
                        setParagraphs([]);
                    }
                    
                    setIsLoading(false);
                };
                reader.readAsDataURL(file);
            };

            const speakText = (text) => {
                // ÂÅúÊ≠¢‰πãÂâçÁöÑÊí≠Êîæ
                if (window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                }
                
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                }
            };

            const openWordDetail = async (word) => {
                setIsLoading(true);
                try {
                    const response = await fetch(`${API_BASE_URL}/api/dictionary/${word}`);
                    if (!response.ok) throw new Error('ËØçÂÖ∏Êü•ËØ¢Â§±Ë¥•');
                    
                    const data = await response.json();
                    setSelectedWord(data);
                } catch (error) {
                    console.error('Êü•ËØ¢Â§±Ë¥•:', error);
                    alert('ÂçïËØçÊü•ËØ¢Â§±Ë¥•');
                }
                setIsLoading(false);
            };

            const addToNewWords = (word) => {
                if (!newWords.find(w => w.word === word.word)) {
                    setNewWords([...newWords, { ...word, savedAt: new Date().toISOString() }]);
                    alert('‚úÖ Â∑≤Ê∑ªÂä†Âà∞ÁîüËØçÊú¨!');
                } else {
                    alert('‚ÑπÔ∏è ËØ•ÂçïËØçÂ∑≤Âú®ÁîüËØçÊú¨‰∏≠');
                }
            };

            const addToMastered = (word) => {
                // ‰ªéÁîüËØçÊú¨ÁßªÈô§
                setNewWords(newWords.filter(w => w.word !== word.word));
                // Ê∑ªÂä†Âà∞ÁÜüËØçÊú¨
                if (!masteredWords.find(w => w.word === word.word)) {
                    setMasteredWords([...masteredWords, { ...word, masteredAt: new Date().toISOString() }]);
                    alert('‚úÖ Â∑≤Ê∑ªÂä†Âà∞ÁÜüËØçÊú¨!');
                    setSelectedWord(null);
                } else {
                    alert('‚ÑπÔ∏è ËØ•ÂçïËØçÂ∑≤Âú®ÁÜüËØçÊú¨‰∏≠');
                }
            };

            const removeFromNewWords = (wordToRemove) => {
                if (confirm(`Á°ÆÂÆö‰ªéÁîüËØçÊú¨Âà†Èô§"${wordToRemove}"?`)) {
                    setNewWords(newWords.filter(w => w.word !== wordToRemove));
                }
            };

            const removeFromMastered = (wordToRemove) => {
                if (confirm(`Á°ÆÂÆö‰ªéÁÜüËØçÊú¨Âà†Èô§"${wordToRemove}"?`)) {
                    setMasteredWords(masteredWords.filter(w => w.word !== wordToRemove));
                }
            };

            // ÁîüËØçÊú¨È°µÈù¢
            if (currentView === 'newWords') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-8">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-xl p-6">
                                <div className="flex items-center justify-between mb-6">
                                    <button onClick={() => setCurrentView('home')} className="flex items-center gap-2 text-gray-600 hover:text-gray-900">
                                        <ArrowLeft /> ËøîÂõû
                                    </button>
                                    <h2 className="text-2xl font-bold text-gray-800">üìù ÁîüËØçÊú¨ ({newWords.length})</h2>
                                    <div className="w-20"></div>
                                </div>
                                {newWords.length === 0 ? (
                                    <div className="text-center py-12 text-gray-400">
                                        <div className="flex justify-center mb-4"><BookOpen /></div>
                                        <p>ËøòÊ≤°Êúâ‰øùÂ≠òÁöÑÁîüËØç</p>
                                    </div>
                                ) : (
                                    <div className="grid gap-4">
                                        {newWords.map((word, idx) => (
                                            <div key={idx} className="border rounded-xl p-4 hover:shadow-md transition">
                                                <div className="flex items-start justify-between">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <h3 className="text-xl font-bold text-blue-600">{word.word}</h3>
                                                            <button onClick={() => speakText(word.word)} className="p-1 hover:bg-blue-50 rounded-full">
                                                                <Volume2 />
                                                            </button>
                                                            <span className="text-sm text-gray-500">{word.phonetic}</span>
                                                        </div>
                                                        <p className="text-gray-700 mb-2">{word.translation}</p>
                                                        <button onClick={() => addToMastered(word)} className="text-sm bg-green-500 text-white px-3 py-1 rounded-full hover:bg-green-600">
                                                            ÁßªËá≥ÁÜüËØçÊú¨
                                                        </button>
                                                    </div>
                                                    <button onClick={() => removeFromNewWords(word.word)} className="p-2 text-red-500 hover:bg-red-50 rounded-full">
                                                        <Trash2 />
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // ÁÜüËØçÊú¨È°µÈù¢
            if (currentView === 'mastered') {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 p-4 sm:p-8">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-xl p-6">
                                <div className="flex items-center justify-between mb-6">
                                    <button onClick={() => setCurrentView('home')} className="flex items-center gap-2 text-gray-600 hover:text-gray-900">
                                        <ArrowLeft /> ËøîÂõû
                                    </button>
                                    <h2 className="text-2xl font-bold text-gray-800">‚≠ê ÁÜüËØçÊú¨ ({masteredWords.length})</h2>
                                    <div className="w-20"></div>
                                </div>
                                {masteredWords.length === 0 ? (
                                    <div className="text-center py-12 text-gray-400">
                                        <div className="flex justify-center mb-4"><Star /></div>
                                        <p>ËøòÊ≤°ÊúâÊéåÊè°ÁöÑÂçïËØç</p>
                                    </div>
                                ) : (
                                    <div className="grid gap-4">
                                        {masteredWords.map((word, idx) => (
                                            <div key={idx} className="border border-green-200 rounded-xl p-4 hover:shadow-md transition bg-green-50">
                                                <div className="flex items-start justify-between">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <h3 className="text-xl font-bold text-green-600">{word.word}</h3>
                                                            <button onClick={() => speakText(word.word)} className="p-1 hover:bg-green-100 rounded-full">
                                                                <Volume2 />
                                                            </button>
                                                            <span className="text-sm text-gray-500">{word.phonetic}</span>
                                                        </div>
                                                        <p className="text-gray-700">{word.translation}</p>
                                                    </div>
                                                    <button onClick={() => removeFromMastered(word.word)} className="p-2 text-red-500 hover:bg-red-50 rounded-full">
                                                        <Trash2 />
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // ÂçïËØçËØ¶ÊÉÖÈ°µ
            if (selectedWord) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-8">
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-xl p-6 sm:p-8">
                                <div className="flex items-center justify-between mb-6">
                                    <button onClick={() => setSelectedWord(null)} className="flex items-center gap-2 text-gray-600">
                                        <ArrowLeft /> ËøîÂõû
                                    </button>
                                    <div className="flex gap-2">
                                        <button onClick={() => addToNewWords(selectedWord)} className="flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-600 text-sm">
                                            <Save /> Ê∑ªÂä†Âà∞ÁîüËØçÊú¨
                                        </button>
                                        <button onClick={() => addToMastered(selectedWord)} className="flex items-center gap-2 bg-green-500 text-white px-4 py-2 rounded-full hover:bg-green-600 text-sm">
                                            <Star /> Ê∑ªÂä†Âà∞ÁÜüËØçÊú¨
                                        </button>
                                    </div>
                                </div>
                                <div className="text-center mb-8">
                                    <h1 className="text-4xl font-bold text-blue-600 mb-3">{selectedWord.word}</h1>
                                    <div className="flex items-center justify-center gap-3 mb-2">
                                        <button onClick={() => speakText(selectedWord.word)} className="bg-blue-500 text-white p-3 rounded-full hover:bg-blue-600">
                                            <Volume2 />
                                        </button>
                                        <span className="text-xl text-gray-600">{selectedWord.phonetic}</span>
                                    </div>
                                    <span className="inline-block bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm">{selectedWord.level}</span>
                                </div>
                                <div className="mb-6">
                                    <h3 className="text-lg font-semibold mb-2 flex items-center gap-2">
                                        <BookOpen /> ‰∏≠ÊñáÈáä‰πâ
                                    </h3>
                                    <p className="text-xl bg-blue-50 p-4 rounded-lg">{selectedWord.translation}</p>
                                </div>
                                <div className="mb-6">
                                    <h3 className="text-lg font-semibold mb-2">Ëã±ÊñáÂÆö‰πâ</h3>
                                    <p className="bg-gray-50 p-4 rounded-lg">{selectedWord.definition}</p>
                                </div>
                                {selectedWord.examples && selectedWord.examples.length > 0 && (
                                    <div className="mb-6">
                                        <h3 className="text-lg font-semibold mb-2">‰æãÂè•</h3>
                                        {selectedWord.examples.map((ex, i) => (
                                            <div key={i} className="bg-green-50 p-3 rounded-lg mb-2 flex gap-2">
                                                <button onClick={() => speakText(ex)} className="p-1"><Volume2 /></button>
                                                <p className="flex-1">{ex}</p>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                <div className="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4">
                                    <h3 className="font-semibold mb-2 flex items-center gap-2">
                                        <Lightbulb /> ËÆ∞ÂøÜÊäÄÂ∑ß
                                    </h3>
                                    <p>{selectedWord.memory}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // È¶ñÈ°µ
            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-8">
                    <div className="max-w-4xl mx-auto">
                        <div className="text-center mb-8">
                            <h1 className="text-3xl sm:text-4xl font-bold text-gray-800 mb-2">üìö Ëã±ËØ≠Â≠¶‰π†Â∑•ÂÖ∑</h1>
                            <p className="text-gray-600">‰∏ä‰º†Ëã±ÊñáÊà™ÂõæÔºåAIËØÜÂà´Â≠¶‰π†</p>
                        </div>

                        {apiStatus === 'checking' && (
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4 flex items-center gap-3">
                                <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"></div>
                                <p className="text-blue-700">ËøûÊé•ÂêéÁ´Ø‰∏≠...</p>
                            </div>
                        )}
                        {apiStatus === 'error' && (
                            <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                                <div className="flex items-start gap-3">
                                    <AlertCircle />
                                    <div>
                                        <p className="text-red-700 font-semibold">‚ö†Ô∏è ÂêéÁ´ØÊú™ËøûÊé•</p>
                                        <button onClick={checkApiStatus} className="mt-2 text-sm bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                                            ÈáçÊñ∞ËøûÊé•
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                        {apiStatus === 'connected' && (
                            <div className="bg-green-50 border border-green-200 rounded-lg p-3 mb-4 flex items-center justify-center gap-2">
                                <CheckCircle />
                                <p className="text-green-700 font-medium">‚úÖ ÂêéÁ´ØÂ∑≤ËøûÊé•</p>
                            </div>
                        )}

                        <div className="flex gap-3 mb-4">
                            <button onClick={() => setCurrentView('newWords')} className="flex-1 flex items-center justify-center gap-2 bg-blue-500 text-white px-4 py-3 rounded-xl hover:bg-blue-600 font-medium">
                                <BookOpen /> ÁîüËØçÊú¨ ({newWords.length})
                            </button>
                            <button onClick={() => setCurrentView('mastered')} className="flex-1 flex items-center justify-center gap-2 bg-green-500 text-white px-4 py-3 rounded-xl hover:bg-green-600 font-medium">
                                <Star /> ÁÜüËØçÊú¨ ({masteredWords.length})
                            </button>
                        </div>

                        {!image && (
                            <div className="bg-white rounded-2xl shadow-xl p-8">
                                <label className={`flex flex-col items-center justify-center border-2 border-dashed rounded-xl p-12 transition ${apiStatus === 'connected' ? 'border-blue-300 cursor-pointer hover:border-blue-500 hover:bg-blue-50' : 'border-gray-300 opacity-50 cursor-not-allowed'}`}>
                                    <Upload />
                                    <span className="text-lg text-gray-700 mb-2 mt-4">
                                        {apiStatus === 'connected' ? 'ÁÇπÂáª‰∏ä‰º†Ëã±ÊñáÊà™Âõæ' : 'Á≠âÂæÖËøûÊé•...'}
                                    </span>
                                    <span className="text-sm text-gray-500">ÊîØÊåÅ JPG, PNG</span>
                                    <input type="file" accept="image/*" onChange={handleImageUpload} disabled={apiStatus !== 'connected'} className="hidden" />
                                </label>
                            </div>
                        )}

                        {image && (
                            <div className="bg-white rounded-2xl shadow-xl p-6">
                                <div className="flex justify-between mb-4">
                                    <h2 className="text-xl font-bold">AIËØÜÂà´ÁªìÊûú</h2>
                                    <button onClick={() => { setImage(null); setExtractedText(''); setWords([]); setParagraphs([]); setTranslation(''); }} className="text-red-500 hover:bg-red-50 p-2 rounded-full">
                                        <X />
                                    </button>
                                </div>
                                <img src={image} alt="‰∏ä‰º†ÁöÑÂõæ" className="w-full rounded-lg mb-4 max-h-64 object-contain bg-gray-50" />
                                {isLoading ? (
                                    <div className="text-center py-8">
                                        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
                                        <p>AIËØÜÂà´‰∏≠...</p>
                                    </div>
                                ) : (
                                    <>
                                        {paragraphs.length > 0 && (
                                            <>
                                                <div className="mb-4">
                                                    <h3 className="font-semibold text-gray-800 mb-3">ËØÜÂà´ÊñáÊú¨</h3>
                                                    <div className="space-y-4">
                                                        {paragraphs.map((para, idx) => (
                                                            <div key={idx} className="border border-gray-200 rounded-lg overflow-hidden">
                                                                {/* Ëã±ÊñáÂéüÊñá */}
                                                                <div className="bg-gray-50 p-4">
                                                                    <div className="flex justify-between items-start mb-2">
                                                                        <span className="text-xs font-medium text-gray-500 bg-white px-2 py-1 rounded">ÊÆµËêΩ {idx + 1}</span>
                                                                        <button 
                                                                            onClick={() => speakText(para.text)} 
                                                                            className="flex items-center gap-1 text-blue-600 px-2 py-1 rounded-full text-xs hover:bg-blue-50"
                                                                        >
                                                                            <Volume2 /> ÊúóËØª
                                                                        </button>
                                                                    </div>
                                                                    <p className="text-gray-800 leading-relaxed">{para.text}</p>
                                                                </div>
                                                                {/* ‰∏≠ÊñáÁøªËØë */}
                                                                <div className="bg-blue-50 p-4 border-t border-blue-100">
                                                                    <p className="text-sm text-gray-600 mb-1">‰∏≠ÊñáÁøªËØë:</p>
                                                                    <p className="text-gray-700">{para.translation}</p>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                                <div>
                                                    <h3 className="font-semibold text-gray-800 mb-3">ËØÜÂà´Âà∞ {words.length} ‰∏™ÂçïËØç</h3>
                                                    <div className="flex flex-wrap gap-2">
                                                        {words.map((word, i) => (
                                                            <button key={i} onClick={() => openWordDetail(word)} className="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-full hover:shadow-lg transform hover:scale-105 transition">
                                                                {word}
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            </>
                                        )}
                                    </>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<EnglishLearningTool />, document.getElementById('root'));
    </script>
</body>
</html>
