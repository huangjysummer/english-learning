<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英语学习工具</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // 图标组件
        const Volume2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
        );

        const BookOpen = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
        );

        const X = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const ArrowLeft = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
        );

        const Lightbulb = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M9 18h6M10 22h4M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"></path>
            </svg>
        );

        const Save = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            </svg>
        );

        const Trash2 = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
            </svg>
        );

        function EnglishLearningTool() {
            const [inputText, setInputText] = useState('');
            const [words, setWords] = useState([]);
            const [selectedWord, setSelectedWord] = useState(null);
            const [savedWords, setSavedWords] = useState(() => {
                try {
                    const saved = localStorage.getItem('englishLearningWords');
                    return saved ? JSON.parse(saved) : [];
                } catch {
                    return [];
                }
            });
            const [showSavedWords, setShowSavedWords] = useState(false);

            useEffect(() => {
                try {
                    localStorage.setItem('englishLearningWords', JSON.stringify(savedWords));
                } catch (error) {
                    console.error('保存失败');
                }
            }, [savedWords]);

            const handleTextSubmit = () => {
                if (!inputText.trim()) {
                    alert('请输入英文文本');
                    return;
                }
                const wordList = inputText.match(/\b[a-zA-Z]+\b/g) || [];
                const uniqueWords = [...new Set(wordList.map(w => w.toLowerCase()))];
                setWords(uniqueWords.filter(w => w.length > 2));
            };

            const speakText = (text) => {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                }
            };

            const dictionary = {
                'hello': { phonetic: '/həˈləʊ/', translation: '你好；哈喽', definition: '用于打招呼', examples: ['Hello, how are you?', 'Say hello to your family.'], memory: '想象挥手说"嗨~喽~"', level: '基础' },
                'welcome': { phonetic: '/ˈwelkəm/', translation: '欢迎', definition: '热情接待', examples: ['Welcome to our school.'], memory: 'well(好) + come(来)', level: '基础' },
                'learning': { phonetic: '/ˈlɜːrnɪŋ/', translation: '学习', definition: '获取知识', examples: ['Learning English is fun.'], memory: 'learn + ing', level: '基础' },
                'english': { phonetic: '/ˈɪŋɡlɪʃ/', translation: '英语；英国的', definition: '英语语言', examples: ['I study English every day.'], memory: 'England(英国) → English', level: '基础' },
                'study': { phonetic: '/ˈstʌdi/', translation: '学习；研究', definition: '学习或研究', examples: ['I study hard.'], memory: '发音像"死大敌"，对抗无知', level: '基础' },
                'good': { phonetic: '/ɡʊd/', translation: '好的', definition: '质量好的', examples: ['Good job!'], memory: '发音像"古德"', level: '基础' },
                'great': { phonetic: '/ɡreɪt/', translation: '伟大的；很好的', definition: '非常好', examples: ['Great work!'], memory: 'grate(炉栅) 但更great', level: '基础' },
                'wonderful': { phonetic: '/ˈwʌndəfl/', translation: '精彩的；极好的', definition: '令人惊叹的', examples: ['What a wonderful day!'], memory: 'wonder(惊奇) + ful', level: '中级' },
                'beautiful': { phonetic: '/ˈbjuːtɪfl/', translation: '美丽的', definition: '外表好看的', examples: ['She is beautiful.'], memory: 'beauty(美丽) + ful', level: '基础' },
                'important': { phonetic: '/ɪmˈpɔːtnt/', translation: '重要的', definition: '有重大意义的', examples: ['This is important.'], memory: 'import(进口) 重要货物', level: '中级' }
            };

            const getWordDetails = (word) => {
                return dictionary[word.toLowerCase()] || {
                    phonetic: `/${word}/`,
                    translation: '暂无释义',
                    definition: '点击发音听读音',
                    examples: [],
                    memory: '多看多记',
                    level: '待学习'
                };
            };

            const openWordDetail = (word) => {
                setSelectedWord({ word, ...getWordDetails(word) });
            };

            const saveWord = (word) => {
                if (!savedWords.find(w => w.word === word.word)) {
                    setSavedWords([...savedWords, { ...word, savedAt: new Date().toISOString() }]);
                    alert('✅ 已保存到生词本!');
                } else {
                    alert('ℹ️ 该单词已在生词本中');
                }
            };

            const removeWord = (wordToRemove) => {
                if (confirm(`确定删除"${wordToRemove}"?`)) {
                    setSavedWords(savedWords.filter(w => w.word !== wordToRemove));
                }
            };

            if (showSavedWords) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-8">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-xl p-6">
                                <div className="flex items-center justify-between mb-6">
                                    <button onClick={() => setShowSavedWords(false)} className="flex items-center gap-2 text-gray-600 hover:text-gray-900">
                                        <ArrowLeft /> 返回
                                    </button>
                                    <h2 className="text-2xl font-bold text-gray-800">生词本 ({savedWords.length})</h2>
                                    <div className="w-20"></div>
                                </div>
                                {savedWords.length === 0 ? (
                                    <div className="text-center py-12 text-gray-400">
                                        <BookOpen className="w-16 h-16 mx-auto mb-4" />
                                        <p>还没有保存的单词</p>
                                    </div>
                                ) : (
                                    <div className="grid gap-4">
                                        {savedWords.map((word, idx) => (
                                            <div key={idx} className="border rounded-xl p-4 hover:shadow-md transition">
                                                <div className="flex items-start justify-between">
                                                    <div className="flex-1">
                                                        <div className="flex items-center gap-3 mb-2">
                                                            <h3 className="text-xl font-bold text-blue-600">{word.word}</h3>
                                                            <button onClick={() => speakText(word.word)} className="p-1 hover:bg-blue-50 rounded-full">
                                                                <Volume2 />
                                                            </button>
                                                            <span className="text-sm text-gray-500">{word.phonetic}</span>
                                                        </div>
                                                        <p className="text-gray-700">{word.translation}</p>
                                                    </div>
                                                    <button onClick={() => removeWord(word.word)} className="p-2 text-red-500 hover:bg-red-50 rounded-full">
                                                        <Trash2 />
                                                    </button>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            if (selectedWord) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-8">
                        <div className="max-w-2xl mx-auto">
                            <div className="bg-white rounded-2xl shadow-xl p-6 sm:p-8">
                                <div className="flex items-center justify-between mb-6">
                                    <button onClick={() => setSelectedWord(null)} className="flex items-center gap-2 text-gray-600 hover:text-gray-900">
                                        <ArrowLeft /> 返回
                                    </button>
                                    <button onClick={() => saveWord(selectedWord)} className="flex items-center gap-2 bg-green-500 text-white px-4 py-2 rounded-full hover:bg-green-600 text-sm">
                                        <Save /> 保存
                                    </button>
                                </div>
                                <div className="text-center mb-8">
                                    <h1 className="text-4xl font-bold text-blue-600 mb-3">{selectedWord.word}</h1>
                                    <div className="flex items-center justify-center gap-3 mb-2">
                                        <button onClick={() => speakText(selectedWord.word)} className="bg-blue-500 text-white p-3 rounded-full hover:bg-blue-600">
                                            <Volume2 />
                                        </button>
                                        <span className="text-xl text-gray-600">{selectedWord.phonetic}</span>
                                    </div>
                                    <span className="inline-block bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm">{selectedWord.level}</span>
                                </div>
                                <div className="mb-6">
                                    <h3 className="text-lg font-semibold mb-2 flex items-center gap-2">
                                        <BookOpen /> 中文释义
                                    </h3>
                                    <p className="text-xl bg-blue-50 p-4 rounded-lg">{selectedWord.translation}</p>
                                </div>
                                <div className="mb-6">
                                    <h3 className="text-lg font-semibold mb-2">英文定义</h3>
                                    <p className="bg-gray-50 p-4 rounded-lg">{selectedWord.definition}</p>
                                </div>
                                {selectedWord.examples.length > 0 && (
                                    <div className="mb-6">
                                        <h3 className="text-lg font-semibold mb-2">例句</h3>
                                        {selectedWord.examples.map((ex, i) => (
                                            <div key={i} className="bg-green-50 p-3 rounded-lg mb-2">
                                                <div className="flex gap-2">
                                                    <button onClick={() => speakText(ex)} className="p-1 hover:bg-green-100 rounded-full">
                                                        <Volume2 />
                                                    </button>
                                                    <p className="flex-1">{ex}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                                <div className="bg-yellow-50 border-2 border-yellow-200 rounded-xl p-4">
                                    <h3 className="font-semibold mb-2 flex items-center gap-2">
                                        <Lightbulb /> 记忆技巧
                                    </h3>
                                    <p className="text-gray-700">{selectedWord.memory}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 sm:p-8">
                    <div className="max-w-4xl mx-auto">
                        <div className="text-center mb-8">
                            <h1 className="text-3xl sm:text-4xl font-bold text-gray-800 mb-2">📚 英语学习工具</h1>
                            <p className="text-gray-600">输入或粘贴英文文本，轻松学习每个单词</p>
                        </div>

                        <div className="flex justify-end mb-4">
                            <button onClick={() => setShowSavedWords(true)} className="flex items-center gap-2 bg-purple-500 text-white px-4 py-2 rounded-full hover:bg-purple-600">
                                <BookOpen /> 生词本 ({savedWords.length})
                            </button>
                        </div>

                        <div className="bg-white rounded-2xl shadow-xl p-6 sm:p-8 mb-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">输入英文文本</h2>
                            <textarea
                                value={inputText}
                                onChange={(e) => setInputText(e.target.value)}
                                placeholder="在这里输入或粘贴英文文本...&#10;&#10;例如：Hello! Welcome to our English learning tool. This app helps you learn English from everyday texts."
                                className="w-full h-48 p-4 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 resize-none text-gray-800"
                            />
                            <div className="flex gap-3 mt-4">
                                <button
                                    onClick={handleTextSubmit}
                                    className="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium"
                                >
                                    开始学习
                                </button>
                                <button
                                    onClick={() => speakText(inputText)}
                                    className="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 flex items-center gap-2"
                                >
                                    <Volume2 /> 朗读
                                </button>
                                <button
                                    onClick={() => { setInputText(''); setWords([]); }}
                                    className="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300"
                                >
                                    清空
                                </button>
                            </div>
                        </div>

                        {words.length > 0 && (
                            <div className="bg-white rounded-2xl shadow-xl p-6">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">识别到 {words.length} 个单词 (点击学习)</h3>
                                <div className="flex flex-wrap gap-2">
                                    {words.map((word, i) => (
                                        <button
                                            key={i}
                                            onClick={() => openWordDetail(word)}
                                            className="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-full hover:shadow-lg transform hover:scale-105 transition"
                                        >
                                            {word}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="bg-white rounded-2xl shadow-xl p-6 mt-6">
                            <h3 className="font-semibold text-gray-800 mb-3">💡 使用说明</h3>
                            <ul className="space-y-2 text-sm text-gray-600">
                                <li>✅ <strong>已实现功能:</strong> 文本输入、单词提取、详细学习、生词本保存、语音朗读</li>
                                <li>📝 在文本框中输入或粘贴英文段落</li>
                                <li>🔍 点击"开始学习"自动提取所有单词</li>
                                <li>👆 点击任意单词查看详细释义、例句和记忆技巧</li>
                                <li>💾 保存重要单词到生词本，数据永久存储</li>
                                <li>🔊 可以朗读整段文本或单个单词</li>
                            </ul>
                            <div className="mt-4 bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm">
                                <p className="text-blue-700"><strong>提示:</strong> 这个版本使用文本输入，100%稳定可用。图片识别功能可以后续添加!</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<EnglishLearningTool />, document.getElementById('root'));
    </script>
</body>
</html>